{% extends 'base.html' %}

{% block content %}
{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <div class="alert {{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    </ul>
{% endif %}
<div class="container">
    <h1 class="site-title">Connexion</h1>
</div>
<div class="container">
    <form id="loginForm">
        <p class="txt">
            <label for="email">Courriel :</label>
            <input id="email" type="email" name="email" class="form-control card">
        </p>
        <p class="txt">
            <label for="password">Mot de passe :</label>
            <input id="password" type="password" name="password" class="form-control card">
        </p>
        <button type="submit" class="button.card card">Connexion</button>
    </form>
</div>
<div class="container">
    <p class="text fadeIn card">Pas encore inscrit ? <a href="{% url 'signup' %}">Créez un compte</a>.</p>
</div>
<script>
document.getElementById('loginForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Empêcher la soumission standard du formulaire

    const formData = new FormData(this);
    const url = '/api-token-auth/'; // Assurez-vous que cette URL est correctement configurée dans vos urls.py

    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            username: formData.get('email'), // Assurez-vous que votre backend attend 'username' et pas 'email'
            password: formData.get('password')
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.token) {
            localStorage.setItem('jwtToken', data.token);  // Stocker le token JWT dans localStorage
            alert('Connexion réussie');
            window.location.href = '/'; // Rediriger vers la page d'accueil après la connexion
        } else {
            alert('Connexion échouée: ' + data.non_field_errors);
        }
    })
    .catch(error => console.error('Error:', error));
});
</script>
{% endblock %}
